@using Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Map Roles";
}

<h1>Assign Roles to users</h1>

<head>
    <style>
        .checkbox-container {
            border: 1px solid #ccc;
            padding: 10px;
            width: 200px;
        }

        .checkbox-item {
            margin-bottom: 5px;
        }
    </style>
</head>
<hr />

<div class="row">
    <div class="col-md-4">
        <form asp-controller="Login" asp-action="MapUserRole" id="addsurvey">

            <div class="form-group">
                <label class="control-label">Select User</label>
                <select class="form-control" id="ddlusers" name="User_id">
                    <option value="0">Select User</option>
                   
                </select>
                
            </div>
            <div class="checkbox-container" id="checkbox_dynamic">
                @* <div class="checkbox-item">
                    <input type="checkbox" id="checkbox1" name="roles">
                    <label for="checkbox1">Checkbox 1</label>
                </div> *@
            </div>

            <button type="submit">Save</button>

        </form>
    </div>
</div>


@section Scripts {

    <script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.10.2.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            BindUserList();
        });

        function BindUserList() {
            var strHTML = '';
            $.ajax({
                url: '/Login/BindUserList',
                type: 'GET',                
                data: {},                   
                dataType: 'json',           
                success: function (response) {
                    
                    console.log(response[0]);
                    console.log(response)
                    for (var i = 0; i < response.length; i++) {
                        strHTML += "<option value="+response[i].Id+">"+response[i].UserName+"</option>";
                    }
                    $("#ddlusers").append(strHTML);

                },
                error: function (xhr, status, error) {
                    // Function to be executed if the request fails
                    console.error(xhr.responseText);
                }
            });

        }

        $("#ddlusers").change(function () {
            var strHTML = "";
            var selected_userid = $('#ddlusers :selected').val();
            $.ajax({
                url: '/Login/BindCheckBox?user_id='+selected_userid,
                type: 'GET',
                data: {},
                dataType: 'json',
                success: function (response) {
                    console.log(response)
                    console.log(response[0].Roles)
                    var count_id = 0;
                    for (var i = 0; i < response.length; i++) {
                        count_id++;
                        
                        strHTML += '<div class="checkbox-item">';
                        if ($.inArray(response[i].Id, response[0].Roles) !== -1) {
                            strHTML += '<input type="checkbox" value="' + response[i].Id + '" id="checkbox' + count_id + '" name="Roles" checked>';
                        }
                        else {
                            strHTML += '<input type="checkbox" value="' + response[i].Id + '" id="checkbox' + count_id + '" name="Roles">';
                        }
                        strHTML += '<label for=checkbox' + count_id + '>' + response[i].Name + '</label>';
                        strHTML += '</div>';
                    }
                    $("#checkbox_dynamic").html(strHTML);
                },
                error: function (xhr, status, error) {
                    // Function to be executed if the request fails
                    console.error(xhr.responseText);
                }
            });
        });
    </script>

}