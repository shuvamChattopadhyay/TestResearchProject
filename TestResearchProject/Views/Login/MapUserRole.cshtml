@using Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Map Roles";
}

<h1>Assign Roles to users</h1>

<head>
    <style>
        .custom-dropdown {
            position: relative;
            width: 100%;
        }

            .custom-dropdown select {
                appearance: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                background: transparent;
                border: 1px solid #ccc;
                padding: 8px;
                width: 100%;
                cursor: pointer;
            }

                .custom-dropdown select:focus {
                    outline: none;
                }

        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

            .btn-primary:hover {
                background-color: #0056b3;
            }

    </style>
</head>
<hr />

@{
    if (TempData["message"] != null)
    {
        <div class="alert alert-success">
            @TempData["message"]
        </div>
    }
}

<div class="row">
    <div class="col-md-4">
        <form asp-controller="Login" asp-action="MapUserRole" id="addsurvey">

            <div class="form-group">
                <label class="control-label">Select User</label>
                <div class="custom-dropdown">
                    <select class="form-control custom-select" id="ddlusers" name="User_id">
                        <option value="0">Select User</option>
                        <!-- Add more options here if needed -->
                    </select>
                </div>
            </div>

            <div class="checkbox-container" id="checkbox_dynamic">
                <!-- Add dynamic checkboxes here if needed -->
            </div>

            <button type="submit" class="btn btn-primary">Save</button>

        </form>
    </div>
</div>


@section Scripts {

    <script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.10.2.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            BindUserList();
        });

        function BindUserList() {
            var strHTML = '';
            $.ajax({
                url: '/Login/BindUserList',
                type: 'GET',                
                data: {},                   
                dataType: 'json',           
                success: function (response) {
                    
                    console.log(response[0]);
                    console.log(response)
                    for (var i = 0; i < response.length; i++) {
                        strHTML += "<option value="+response[i].Id+">"+response[i].UserName+"</option>";
                    }
                    $("#ddlusers").append(strHTML);

                },
                error: function (xhr, status, error) {
                    // Function to be executed if the request fails
                    console.error(xhr.responseText);
                }
            });

        }

        $("#ddlusers").change(function () {
            var strHTML = "";
            var selected_userid = $('#ddlusers :selected').val();
            $.ajax({
                url: '/Login/BindCheckBox?user_id='+selected_userid,
                type: 'GET',
                data: {},
                dataType: 'json',
                success: function (response) {
                    console.log(response)
                    console.log(response[0].Roles)
                    var count_id = 0;
                    for (var i = 0; i < response.length; i++) {
                        count_id++;
                        
                        strHTML += '<div class="checkbox-item">';
                        if ($.inArray(response[i].Id, response[0].Roles) !== -1) {
                            strHTML += '<input type="checkbox" value="' + response[i].Id + '" id="checkbox' + count_id + '" name="Roles" checked>';
                        }
                        else {
                            strHTML += '<input type="checkbox" value="' + response[i].Id + '" id="checkbox' + count_id + '" name="Roles">';
                        }
                        strHTML += '<label for=checkbox' + count_id + '>' + response[i].Name + '</label>';
                        strHTML += '</div>';
                    }
                    $("#checkbox_dynamic").html(strHTML);
                },
                error: function (xhr, status, error) {
                    // Function to be executed if the request fails
                    console.error(xhr.responseText);
                }
            });
        });
    </script>

}